<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Posture Detection</title>
    <style>
        #video-container {
            position: relative;
        }
        #video {
            width: 640px;
            height: 480px;
        }
        #posture-text {
            position: absolute;
            bottom: 10px;
            left: 10px;
            font-size: 20px;
            color: blue;
        }
        #record-controls {
            position: absolute;
            top: 10px;
            left: 10px;
        }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="video" autoplay></video>
        <p id="posture-text"></p>
        <div id="record-controls">
            <button id="start-recording">Start Recording</button>
            <button id="stop-recording" disabled>Stop Recording</button>
        </div>
    </div>
    <script>
        const video = document.getElementById('video');
        const postureText = document.getElementById('posture-text');
        const startButton = document.getElementById('start-recording');
        const stopButton = document.getElementById('stop-recording');

        const source = new EventSource('/video_feed');
        let hasFrame = false;
        let isRecording = false;

        startButton.addEventListener('click', () => {
            isRecording = true;
            stopButton.disabled = false;
            startButton.disabled = true;
        });

        stopButton.addEventListener('click', () => {
            isRecording = false;
            stopButton.disabled = true;
            startButton.disabled = false;
        });

        source.onmessage = function(event) {
            if (event.data.startsWith('--frame')) {
                // Handle original frame data
                if (!hasFrame) {
                    const url = window.URL.createObjectURL(new Blob([event.data], {type: "image/jpeg"}));
                    video.src = url;
                    hasFrame = true;
                }
            } else {
                // Update posture text directly
                postureText.textContent = event.data;
            }
        };
    </script>
</body>
</html>